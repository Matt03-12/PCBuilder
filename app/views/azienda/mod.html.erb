<html>
<head>
  <title>Dittatori</title>
</head>
<body style="background-color: #B9B9B9;">
<center>
  <%  $b= request.original_url
      require 'cgi'
      $url = CGI.parse($b)

      $id=$url["http://127.0.0.1:3000/azienda/mod?Id"]
      $id=$id.first

      require 'sqlite3'
      db = SQLite3::Database.open('Data.db')
      db.results_as_hash = true
      $data = db.execute("SELECT * FROM Componenti WHERE Id=#$id")
  %>
  <fieldset style="width:70%;">

    <legend><b>Ordini</b></legend>
    <br>
    <table width='90%' border='1px'>
      <td style="text-align: center">Versione</td>
      <td style="text-align: center">Nome</td>
      <td style="text-align: center">Prezzo</td>
      <td style="text-align: center">Tipo</td>

      <%  (0..$data.length-1).each do |a| %>
        <tr>
          <td style="text-align: center">Precedente</td>
          <td style="text-align: center"><%= $data[a]["Nome"] -%></td>
          <td style="text-align: center"><%= $data[a]["Tipo"] -%></td>
          <td style="text-align: center"><%= $data[a]["Prezzo"] -%></td>

        </tr>

      <form action="/azienda/mod" method="GET">
        <input type="hidden" name="id" value="<%= $data[a]["Id"] -%>" >


      <tr>
        <td style="text-align: center">Modifiche</td>
        <td style="text-align: center">
          <input type="text" id="nome" name="nome">
        </td>
        <td style="text-align: center">

          <select name="Tipo" id="Tipo">
            <option value="Scheda video"> Scheda video </option>
            <option value="Processore"> Processore </option>
            <option value="Scheda madre"> Scheda madre </option>
            <option value="Ram">Ram </option>
            <option value="Hdd">Hdd </option>
            <option value="SSD ">SSD </option>
        </select>

        </td>
        <td style="text-align: center">
          <input type="text" id="prezzo" name="prezzo">
        </td>

      </tr>

    <button type="submit" style=" background-color: #b9b9b9; color: #000000; font-size: 17px " name="button" value="mod">Conferma modifiche</button>
    </form>
    </table>
    <%
      end
    %>
    <%
      $b= request.original_url
      require 'cgi'
      $url = CGI.parse($b)

      $id=$url["id"]
      $but=$url["button"]
      $id=$id.first
      $but=$but.first

      $nome=$url["nome"]
      $pre=$url["prezzo"]
      $nome=$nome.first
      $pre=$pre.first

      $tipo=$url["Tipo"]
      $tipo=$tipo.first



      if $but=="mod"
        require 'sqlite3'
        db = SQLite3::Database.open('Data.db')
        db.results_as_hash = true
        $data = db.execute("UPDATE Componenti SET Nome='#$nome' Prezzo='#$pre' Tipo='#$tipo' WHERE Id ='#$id' ;")
      end
    %>



  </fieldset>
</center>
</body>
</html>
