<html>
<head>
  <title>Dittatori</title>
</head>
<body style="background-color: #B9B9B9;">
<center>
<%  $b= request.original_url
    require 'cgi'
    $url = CGI.parse($b)

    $nome=$url["http://127.0.0.1:3000/azienda/Tecnico?name"]
    $id=$url["Id"]
    $nome=$nome.first
    $id=$id.first

    require 'sqlite3'
    db = SQLite3::Database.open('Data.db')
    db.results_as_hash = true
    $data = db.execute("SELECT * FROM Ordini WHERE Id=#$id")
%>
  <fieldset style="width:70%;">

    <legend><b>Ordini</b></legend>
    <br>
    <table width='90%' border='1px'>
      <td style="text-align: center">Versione</td>
      <td style="text-align: center">Scheda video</td>
      <td style="text-align: center">Processore</td>
      <td style="text-align: center">Scheda madre</td>
      <td style="text-align: center">Ram</td>
      <td style="text-align: center">Hdd</td>
      <td style="text-align: center">SSD</td>
      <%  (0..$data.length-1).each do |a| %>
        <tr>
          <td style="text-align: center">Precedente</td>
          <td style="text-align: center"><%= $data[a]["Schedavideo"] -%></td>
          <td style="text-align: center"><%= $data[a]["Processore"] -%></td>
          <td style="text-align: center"><%= $data[a]["Schedamadre"] -%></td>
          <td style="text-align: center"><%= $data[a]["Ram"] -%></td>
          <td style="text-align: center"><%= $data[a]["Hdd"] -%></td>
          <td style="text-align: center"><%= $data[a]["SSD"] -%></td>
        </tr>
      <%
        end

      %>
      <form action="/azienda/tecmod" method="GET">
        <input type="hidden" name="name"value="<%= $nome -%>" >
        <input type="hidden" name="Id"value="<%= $id -%>" >
      <tr>
        <td style="text-align: center">Modifiche</td>
        <td style="text-align: center">
          <select name="Scheda video" id="Scheda video">
            <option selected disabled>Scheda video</option>
            <% require 'sqlite3'
               db = SQLite3::Database.open('Data.db')
               db.results_as_hash = true
               $data = db.execute("SELECT * FROM Componenti WHERE Tipo='Scheda video'; ") %>
            <%  (0..$data.length-1).each do |a| %>
              <option value="<%= $data[a]["Nome"] -%>"><%= $data[a]["Nome"] -%></option>

        <% end %>
        </select>
        </td>
        <td style="text-align: center">
          <select name="Processore" id="Processore">
            <option selected disabled>Processore</option>
            <% require 'sqlite3'
               db = SQLite3::Database.open('Data.db')
               db.results_as_hash = true
               $data = db.execute("SELECT * FROM Componenti WHERE Tipo='Processore'; ") %>
            <%  (0..$data.length-1).each do |a| %>
              <option value="<%= $data[a]["Nome"] -%>"><%= $data[a]["Nome"] -%></option>

        <% end %>
        </select>
        </td>
        <td style="text-align: center">
          <select name="Scheda madre" id="Scheda madre">
            <option selected disabled>Scheda madre</option>
            <% require 'sqlite3'
               db = SQLite3::Database.open('Data.db')
               db.results_as_hash = true
               $data = db.execute("SELECT * FROM Componenti WHERE Tipo='Scheda madre'; ") %>
            <%  (0..$data.length-1).each do |a| %>
              <option value="<%= $data[a]["Nome"] -%>"><%= $data[a]["Nome"] -%></option>

        <% end %>
        </select>
        </td>
        <td style="text-align: center">
          <select name="Ram" id="Ram">
            <option selected disabled>Ram</option>
            <% require 'sqlite3'
               db = SQLite3::Database.open('Data.db')
               db.results_as_hash = true
               $data = db.execute("SELECT * FROM Componenti WHERE Tipo='Ram'; ") %>
            <%  (0..$data.length-1).each do |a| %>
              <option value="<%= $data[a]["Nome"] -%>"><%= $data[a]["Nome"] -%></option>

        <% end %>
        </select>
        </td>
        <td style="text-align: center">
          <select name="Hdd" id="Hdd">
            <option selected disabled>Hdd</option>
            <% require 'sqlite3'
               db = SQLite3::Database.open('Data.db')
               db.results_as_hash = true
               $data = db.execute("SELECT * FROM Componenti WHERE Tipo='Hdd'; ") %>
            <%  (0..$data.length-1).each do |a| %>
              <option value="<%= $data[a]["Nome"] -%>"><%= $data[a]["Nome"] -%></option>

        <% end %>
        </select>
        </td>
        <td style="text-align: center">
          <select name="SSD" id="SSD">
            <option selected disabled>SSD</option>
            <% require 'sqlite3'
               db = SQLite3::Database.open('Data.db')
               db.results_as_hash = true
               $data = db.execute("SELECT * FROM Componenti WHERE Tipo='SSD'; ") %>
            <%  (0..$data.length-1).each do |a| %>
              <option value="<%= $data[a]["Nome"] -%>"><%= $data[a]["Nome"] -%></option>

        <% end %>
        </select>
        </td>
      </tr>
        </form>
    </table>
    <button type="submit" style=" background-color: #b9b9b9; color: #000000; font-size: 17px " name="button" value="mod">Conferma modifiche</button>
    <%
      $b= request.original_url
      require 'cgi'
      $url = CGI.parse($b)

      $id=$url["id"]
      $but=$url["button"]
      $id=$id.first
      $but=$but.first

      $pro=$url["Processore"]
      $scv=$url["Scheda video"]
      $ram=$url["Ram"]
      $hdd=$url["Hdd"]
      $ssd=$url["SSD"]
      $scm=$url["Scheda madre"]

      $pro=$pro.first
      $scv=$scv.first
      $ram=$ram.first
      $hdd=$hdd.first
      $ssd=$ssd.first
      $scm=$scm.first


      if $but=="log"
        require 'sqlite3'
        db = SQLite3::Database.open('Data.db')
        db.results_as_hash = true
        $data = db.execute("UPDATE Ordini SET Schedavideo='#$scm' Processore='#$pro' Schedamadre='#$scm' Ram='#$ram' hdd='#$hdd' SSD='#$ssd'  WHERE Id ='#$id' ;")
      end
    %>



      </fieldset>
    </center>
</body>
</html>